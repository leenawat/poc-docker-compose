# Basic configuration
http_port 3128

# ACLs
acl localnet src 172.16.0.0/12
acl localnet src 192.168.0.0/16
acl localnet src 10.0.0.0/8
acl SSL_ports port 443
acl Safe_ports port 80 443 8080 8443
acl CONNECT method CONNECT

# Access rules
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localnet
http_access allow localhost
http_access deny all

# ============ LOGGING CONFIGURATION ============

# 1. Access Log (Default format)
access_log /var/log/squid/access.log squid

# 2. Custom detailed access log
logformat detailed %>a %[ui %[un [%tl] "%rm %ru HTTP/%rv" %>Hs %<st "%{Referer}>h" "%{User-Agent}>h" %Ss:%Sh %tr
access_log /var/log/squid/access_detailed.log detailed

# 3. JSON format log (สำหรับ parsing ง่าย)
logformat json {"timestamp":"%{%Y-%m-%d %H:%M:%S}tl","client_ip":"%>a","username":"%[ui","method":"%rm","url":"%ru","http_version":"%rv","status_code":"%>Hs","response_size":"%<st","referer":"%{Referer}>h","user_agent":"%{User-Agent}>h","squid_status":"%Ss","hierarchy_status":"%Sh","response_time":"%tr"}
access_log /var/log/squid/access.json json

# 4. Cache log
cache_log /var/log/squid/cache.log

# 5. Store log (cache operations)
cache_store_log /var/log/squid/store.log

# ============ DEBUG LOGGING ============
# เปิดเมื่อต้องการ debug (ระวัง log จะเยอะมาก!)
# debug_options ALL,1 33,2 28,3

# Cache settings
cache_dir ufs /var/spool/squid 1000 16 256
cache_mem 256 MB
maximum_object_size 50 MB

# DNS and timeouts
dns_timeout 30 seconds
read_timeout 1 minute
request_timeout 1 minute

# Error directory
error_directory /usr/share/squid/errors/English